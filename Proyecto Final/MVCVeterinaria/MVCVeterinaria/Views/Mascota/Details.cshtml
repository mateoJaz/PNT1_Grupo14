@model MVCVeterinaria.Models.Mascota

@{
    ViewData["Title"] = "Historia Clínica";
}

<h1>Historia Clínica</h1>

<div>
    <h3 class="mb-3">Ficha de @Model.Nombre</h3>
</div>

<div class="card bg-light mb-4 shadow-sm" style="max-width: 800px;">
    <div class="card-body">

        <dl class="row mb-0">
            <dt class="col-sm-2">Dueño:</dt>
            <dd class="col-sm-10">
                @Model.Cliente.Apellido, @Model.Cliente.Nombre
            </dd>

            <dt class="col-sm-2">@Html.DisplayNameFor(model => model.Raza):</dt>
            <dd class="col-sm-10">@Html.DisplayFor(model => model.Raza)</dd>

            <dt class="col-sm-2">@Html.DisplayNameFor(model => model.Edad):</dt>
            <dd class="col-sm-10">
                @{
                    if (Model.Edad == -1)
                    {
                        <span class="badge bg-danger">Mascota Fallecida</span>
                    }
                    else
                    {
                        @Html.DisplayFor(model => model.Edad) @Html.Raw(" año/s")
                    }
                }
            </dd>

            <dt class="col-sm-2">@Html.DisplayNameFor(model => model.Peso):</dt>
            <dd class="col-sm-10">@Html.DisplayFor(model => model.Peso) Kg</dd>
        </dl>

    </div>
</div>


<h4>Eventos y Tratamientos</h4>

<table class="table table-bordered table-striped">
    <thead class="thead-dark">
        <tr>
            <th>Fecha</th>
            <th>Tipo</th>
            <th>Detalle / Diagnóstico</th>
            <th>Veterinario</th>
        </tr>
    </thead>
    <tbody>
        @if (Model.HistorialClinico != null && Model.HistorialClinico.Count > 0)
        {
            foreach (var evento in Model.HistorialClinico.OrderByDescending(e => e.FechaHorario))
            {
                <tr>
                    <td>@evento.FechaHorario.ToString("dd/MM/yyyy HH:mm")</td>
                    <td>@evento.TipoEvento</td>
                    <td>@evento.Detalle</td>
                    <td>
                        @if (evento.Veterinario != null)
                        {
                            <span>Dr/a. @evento.Veterinario.Apellido</span>
                        }
                        else
                        {
                            <span>-</span>
                        }
                    </td>
                </tr>
            }
        }
        else
        {
            <tr>
                <td colspan="4" class="text-center text-muted">No hay registros médicos para esta mascota.</td>
            </tr>
        }
    </tbody>
</table>

<div class="mt-4 mb-4 d-flex gap-2">
    <a asp-controller="Evento"
       asp-action="Create"
       asp-route-idMascota="@Model.Id"
       class="btn btn-success">
        Agregar Nuevo Evento
    </a>

    <a asp-controller="Cliente"
       asp-action="Details"
       asp-route-id="@Model.ClienteId"
       class="btn btn-secondary">
        Volver al Cliente
    </a>
</div>